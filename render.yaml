services:
  # --- Backend Service (Web Service) ---
  - type: web
    name: vulnvault-backend
    runtime: docker           # <--- CHANGE: Use Docker
    region: oregon
    plan: free
    branch: main
    dockerfilePath: ./backend/Dockerfile # <--- ADD: Path to your Dockerfile
    # REMOVE buildCommand and startCommand - your Dockerfile already has them (RUN and CMD)
    
    # --- Backend Environment Variables ---
    envVars:
      # You can remove PYTHON_VERSION, it's set in the Dockerfile
      
      # --- SECRETS (Keep these) ---
      - key: MONGODB_URL
        sync: false
      - key: DATABASE_NAME
        value: "vulnvault"
      - key: GEMINI_API_KEY
        sync: false
      - key: CLERK_SECRET_KEY
        sync: false
      - key: EMAIL_ENABLED
        value: "false" 
      - key: EMAIL_SENDER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false

  # --- Frontend Service (Static Site) ---
  - type: web
    name: vulnvault-frontend
    runtime: static
    branch: main
    buildCommand: "cd frontend && npm install && npm run build"
    staticPublishPath: "frontend/dist"
    envVars:
      - key: VITE_API_URL
        value: https://vulnvault-backend.onrender.com