# render.yaml - FINAL CORRECTED VERSION
# Defines a free backend web service and a free static site frontend.

services:
  # --- Backend Service (Web Service) ---
  - type: web
    name: vulnvault-backend
    runtime: python
    region: oregon
    plan: free      # 'free' plan is correct for type: web
    branch: main
    
    # --- Backend Build & Start ---
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT"
    
    # --- Backend Environment Variables ---
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.5
      
      # --- SECRETS ---
      # You MUST add these values manually in the Render Dashboard
      # under the 'Environment' tab for this 'vulnvault-backend' service.
      - key: MONGODB_URL
        sync: false
      - key: DATABASE_NAME
        value: "vulnvault"
      - key: GEMINI_API_KEY
        sync: false
      - key: CLERK_SECRET_KEY
        sync: false
      - key: EMAIL_ENABLED
        value: "false" 
      - key: EMAIL_SENDER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false

  # --- Frontend Service (Static Site) ---
  - type: web
    name: vulnvault-frontend
    runtime: static
    region: oregon
    branch: main
    
    # --- Frontend Build & Publish ---
    buildCommand: "cd frontend && npm install && npm run build"
    # --- THIS IS THE FIX ---
    staticPublishPath: "frontend/dist"  # Changed from publishDir
    
    # --- Frontend Environment Variables ---
    envVars:
      - key: VITE_API_URL
        # This automatically gets the public URL of your backend service
        fromService:
          type: web
          name: vulnvault-backend
          property: url