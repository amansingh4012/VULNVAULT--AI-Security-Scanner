# render.yaml - CORRECTED VERSION
# This Blueprint defines two services:
# 1. A Python (FastAPI) Web Service for the backend
# 2. A Static Site for the frontend

services:
  # --- Backend Service (Web Service) ---
  - type: web
    name: vulnvault-backend
    runtime: python  # Use 'runtime' as per latest docs
    region: oregon
    plan: free      # 'free' plan is valid for type: web
    branch: main
    
    # --- Backend Build & Start ---
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT"
    
    # --- Backend Environment Variables ---
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.5
      
      # --- SECRETS ---
      # You MUST add these values manually in the Render Dashboard
      # under the 'Environment' tab for this 'vulnvault-backend' service.
      - key: MONGODB_URL
        sync: false
      - key: DATABASE_NAME
        value: "vulnvault"
      - key: GEMINI_API_KEY
        sync: false
      - key: CLERK_SECRET_KEY
        sync: false
      - key: EMAIL_ENABLED
        value: "false" # Set to "true" in dashboard if you want email
      - key: EMAIL_SENDER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false

  # --- Frontend Service (Static Site) ---
  - type: web          # <-- FIX 1: Type is 'web'
    name: vulnvault-frontend
    runtime: static    # <-- FIX 2: Runtime is 'static'
    region: oregon
    # 'plan: free' is removed (FIX 3), as static sites are free by default
    branch: main
    
    # --- Frontend Build & Publish ---
    buildCommand: "cd frontend && npm install && npm run build"
    publishDir: "frontend/dist"
    
    # --- Frontend Environment Variables ---
    envVars:
      - key: VITE_API_URL
        # This automatically gets the public URL of your backend service
        fromService:
          type: web
          name: vulnvault-backend
          property: url