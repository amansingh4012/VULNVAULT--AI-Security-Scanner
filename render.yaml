# render.yaml - FINAL CORRECTED VERSION
# Defines a free backend web service and a free static site frontend.

services:
  # --- Backend Service (Web Service) ---
  - type: web
    name: vulnvault-backend  # This name determines the URL
    runtime: python
    region: oregon # Region is correct for 'web' services
    plan: free
    branch: main
    
    # --- Backend Build & Start ---
    buildCommand: "pip install -r backend/requirements.txt"
    startCommand: "cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT"
    
    # --- Backend Environment Variables ---
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.5
      
      # --- SECRETS ---
      # You MUST add these values manually in the Render Dashboard
      # under the 'Environment' tab for this 'vulnvault-backend' service.
      - key: MONGODB_URL
        sync: false
      - key: DATABASE_NAME
        value: "vulnvault"
      - key: GEMINI_API_KEY
        sync: false
      - key: CLERK_SECRET_KEY
        sync: false
      - key: EMAIL_ENABLED
        value: "false" 
      - key: EMAIL_SENDER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false

  # --- Frontend Service (Static Site) ---
  - type: web
    name: vulnvault-frontend
    runtime: static
    # FIX 1: 'region' field removed for static sites
    branch: main
    
    # --- Frontend Build & Publish ---
    buildCommand: "cd frontend && npm install && npm run build"
    staticPublishPath: "frontend/dist"
    
    # --- Frontend Environment Variables ---
    envVars:
      # FIX 2: Set the predictable URL of the backend service
      - key: VITE_API_URL
        value: https://vulnvault-backend.onrender.com